<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Home Control System â€” Team 34</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #070b14;
  --surface: #0e1422;
  --card: #131929;
  --card2: #1a2238;
  --accent: #38bdf8;
  --accent2: #818cf8;
  --green: #34d399;
  --red: #f87171;
  --orange: #fb923c;
  --yellow: #fbbf24;
  --text: #e2e8f0;
  --muted: #64748b;
  --border: rgba(255,255,255,0.07);
  --shadow: 0 8px 32px rgba(0,0,0,0.5);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'IBM Plex Sans Arabic', sans-serif;
  min-height: 100vh;
  display: flex;
  overflow: hidden;
}

/* â”€â”€ Animated bg â”€â”€ */
body::before {
  content:'';
  position:fixed; inset:0;
  background:
    radial-gradient(ellipse 60% 50% at 80% -10%, rgba(56,189,248,.12), transparent),
    radial-gradient(ellipse 50% 40% at -10% 80%, rgba(129,140,248,.1), transparent);
  pointer-events:none; z-index:0;
}

/* â•â• LOGIN SCREEN â•â• */
#loginScreen {
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background: var(--bg);
  z-index:1000;
  animation: fadeIn .4s ease;
}

.login-box {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 24px;
  padding: 48px;
  width: 420px;
  box-shadow: var(--shadow);
  text-align: center;
}

.login-logo {
  width:64px; height:64px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border-radius:18px;
  display:grid; place-items:center;
  font-size:28px;
  margin: 0 auto 20px;
  box-shadow: 0 0 32px rgba(56,189,248,.3);
}

.login-box h2 { font-size:22px; font-weight:700; margin-bottom:4px; }
.login-box p { color:var(--muted); font-size:13px; margin-bottom:32px; }

.input-group { margin-bottom:16px; text-align:right; }
.input-group label { font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
.input-group input {
  width:100%; padding:12px 16px;
  background:var(--card2); border:1px solid var(--border);
  border-radius:12px; color:var(--text); font-family:inherit; font-size:14px;
  outline:none; transition:border-color .2s;
  direction:ltr; text-align:left;
}
.input-group input:focus { border-color:var(--accent); }

.btn-login {
  width:100%; padding:14px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border:none; border-radius:12px;
  color:white; font-size:15px; font-weight:600;
  cursor:pointer; font-family:inherit;
  margin-top:8px;
  transition:opacity .2s, transform .2s;
}
.btn-login:hover { opacity:.9; transform:translateY(-1px); }

.login-hint { margin-top:20px; font-size:12px; color:var(--muted); }

/* â•â• SIDEBAR â•â• */
#sidebar {
  width:240px; min-height:100vh;
  background: var(--surface);
  border-left: 1px solid var(--border);
  display:flex; flex-direction:column;
  position:relative; z-index:10;
  flex-shrink:0;
}

.sidebar-logo {
  padding:24px 20px 20px;
  border-bottom:1px solid var(--border);
}

.logo-row { display:flex; align-items:center; gap:12px; }
.logo-icon {
  width:38px; height:38px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border-radius:10px; display:grid; place-items:center; font-size:18px;
  box-shadow:0 0 16px rgba(56,189,248,.3);
}
.logo-text h3 { font-size:14px; font-weight:700; }
.logo-text span { font-size:11px; color:var(--muted); }

.online-pill {
  margin-top:12px;
  display:flex; align-items:center; gap:6px;
  background:rgba(52,211,153,.1);
  border:1px solid rgba(52,211,153,.2);
  border-radius:50px; padding:5px 12px;
  font-size:11px; color:var(--green);
}
.pulse { width:6px;height:6px;background:var(--green);border-radius:50%;animation:pulse 2s infinite; }

nav { padding:16px 12px; flex:1; }
.nav-section { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:1px; padding:0 8px; margin:12px 0 6px; }

.nav-item {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:10px;
  cursor:pointer; transition:all .2s;
  color:var(--muted); font-size:13px; margin-bottom:2px;
  position:relative;
}
.nav-item:hover { background:rgba(255,255,255,.04); color:var(--text); }
.nav-item.active {
  background:linear-gradient(135deg,rgba(56,189,248,.15),rgba(129,140,248,.15));
  color:var(--accent);
  border:1px solid rgba(56,189,248,.2);
}
.nav-item .icon { font-size:16px; width:20px; text-align:center; }
.badge {
  margin-right:auto; background:var(--red);
  border-radius:50px; padding:1px 7px; font-size:10px; color:white; font-weight:600;
}

.sidebar-bottom {
  padding:16px; border-top:1px solid var(--border);
}
.user-row {
  display:flex; align-items:center; gap:10px;
  padding:10px; border-radius:10px; cursor:pointer;
  transition:background .2s;
}
.user-row:hover { background:rgba(255,255,255,.04); }
.avatar {
  width:34px; height:34px; border-radius:10px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:grid; place-items:center; font-size:14px; font-weight:700; color:white;
}
.user-info { flex:1; }
.user-name { font-size:13px; font-weight:600; }
.user-role { font-size:11px; color:var(--muted); }

/* â•â• MAIN â•â• */
#main {
  flex:1; display:flex; flex-direction:column;
  overflow:hidden; position:relative; z-index:1;
}

/* Topbar */
.topbar {
  display:flex; align-items:center; justify-content:space-between;
  padding:16px 28px;
  border-bottom:1px solid var(--border);
  background:rgba(7,11,20,.8);
  backdrop-filter:blur(12px);
}

.page-title { font-size:18px; font-weight:700; }
.page-sub { font-size:12px; color:var(--muted); margin-top:2px; }

.topbar-right { display:flex; align-items:center; gap:12px; }

.chip {
  background:var(--card); border:1px solid var(--border);
  border-radius:50px; padding:6px 14px;
  font-size:12px; display:flex; align-items:center; gap:6px;
}

.alert-bell {
  width:36px; height:36px; background:var(--card);
  border:1px solid var(--border); border-radius:10px;
  display:grid; place-items:center; cursor:pointer; font-size:16px;
  position:relative; transition:border-color .2s;
}
.alert-bell:hover { border-color:var(--accent); }
.alert-bell .notif {
  position:absolute; top:6px; right:6px;
  width:8px; height:8px; background:var(--red); border-radius:50%;
  border:1.5px solid var(--bg);
}

/* Content area */
#content {
  flex:1; overflow-y:auto; padding:24px 28px;
}

/* â•â• PAGES â•â• */
.page { display:none; animation:fadeIn .3s ease; }
.page.active { display:block; }

@keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(.8)} }

/* â”€â”€ Stats row â”€â”€ */
.stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:24px; }
.stat {
  background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:18px 20px;
  position:relative; overflow:hidden;
  transition:transform .2s;
}
.stat:hover { transform:translateY(-2px); }
.stat::before {
  content:''; position:absolute; top:0; left:0; right:0; height:2px;
  background:linear-gradient(90deg,transparent,var(--c,var(--accent)),transparent);
}
.stat-label { font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:.8px; margin-bottom:10px; }
.stat-val { font-size:26px; font-weight:700; color:var(--c,var(--accent)); line-height:1; }
.stat-unit { font-size:12px; color:var(--muted); margin-top:4px; }
.stat-icon { position:absolute; top:14px; left:14px; font-size:22px; opacity:.12; }

/* â”€â”€ Cards / Panels â”€â”€ */
.panel {
  background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:20px;
}
.panel-title { font-size:14px; font-weight:600; margin-bottom:16px; }

/* â”€â”€ Device cards â”€â”€ */
.devices-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }

.dev-card {
  background:var(--card2); border:1px solid var(--border);
  border-radius:14px; padding:16px; cursor:pointer;
  transition:all .25s; position:relative; overflow:hidden;
}
.dev-card:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,.4); }
.dev-card.on {
  border-color:rgba(56,189,248,.35);
  background:linear-gradient(135deg,var(--card2),rgba(56,189,248,.07));
}
.dev-card.on::after {
  content:''; position:absolute; inset:0;
  background:radial-gradient(circle at top right,rgba(56,189,248,.1),transparent 60%);
  pointer-events:none;
}
.dev-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
.dev-emoji { font-size:26px; }
.dev-name { font-size:13px; font-weight:600; margin-bottom:3px; }
.dev-status { font-size:11px; color:var(--muted); }
.dev-status.on { color:var(--green); }

/* Toggle */
.tog {
  width:38px; height:20px; border-radius:20px;
  background:var(--card); border:1px solid rgba(255,255,255,.1);
  position:relative; cursor:pointer; transition:all .3s; flex-shrink:0;
}
.tog.on { background:linear-gradient(90deg,var(--accent),var(--accent2)); border-color:transparent; box-shadow:0 0 10px rgba(56,189,248,.4); }
.tog-thumb {
  position:absolute; top:2px; right:2px;
  width:14px; height:14px; border-radius:50%;
  background:white; transition:right .3s; box-shadow:0 1px 3px rgba(0,0,0,.3);
}
.tog.on .tog-thumb { right:calc(100% - 16px); }

/* Slider */
.dev-slider { margin-top:10px; }
.slider-row { display:flex; justify-content:space-between; font-size:10px; color:var(--muted); margin-bottom:5px; }
input[type=range] {
  width:100%; -webkit-appearance:none; height:3px;
  border-radius:3px; background:var(--card); outline:none; cursor:pointer;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance:none; width:12px; height:12px; border-radius:50%;
  background:var(--accent); box-shadow:0 0 6px rgba(56,189,248,.5);
}

/* â”€â”€ Sensor cards â”€â”€ */
.sensors-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:14px; }
.sensor-card {
  background:var(--card2); border:1px solid var(--border);
  border-radius:14px; padding:16px;
}
.sensor-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
.sensor-emoji { font-size:22px; }
.sensor-lbl { font-size:11px; color:var(--muted); }
.sensor-val { font-size:28px; font-weight:700; }
.sensor-unit { font-size:12px; color:var(--muted); }

.status-badge {
  display:inline-flex; align-items:center; gap:5px;
  border-radius:50px; padding:4px 12px; font-size:11px; font-weight:600;
}
.status-badge.ok { background:rgba(52,211,153,.12); color:var(--green); border:1px solid rgba(52,211,153,.25); }
.status-badge.warn { background:rgba(251,191,36,.12); color:var(--yellow); border:1px solid rgba(251,191,36,.25); }
.status-badge.danger { background:rgba(248,113,113,.12); color:var(--red); border:1px solid rgba(248,113,113,.25); }

/* â”€â”€ Alerts â”€â”€ */
.alert-item {
  display:flex; align-items:flex-start; gap:12px;
  padding:14px; border-radius:12px; margin-bottom:10px;
  border:1px solid var(--border); background:var(--card2);
  transition:background .2s;
}
.alert-item:hover { background:var(--card); }
.alert-icon { font-size:20px; flex-shrink:0; margin-top:1px; }
.alert-body { flex:1; }
.alert-title { font-size:13px; font-weight:600; margin-bottom:3px; }
.alert-time { font-size:11px; color:var(--muted); }
.alert-item.unread { border-right:3px solid var(--red); }
.alert-item.warn.unread { border-right-color:var(--yellow); }
.mark-btn {
  background:none; border:1px solid var(--border); border-radius:7px;
  padding:4px 10px; color:var(--muted); font-size:11px; cursor:pointer;
  font-family:inherit; transition:all .2s; flex-shrink:0;
}
.mark-btn:hover { border-color:var(--accent); color:var(--accent); }

/* â”€â”€ Logs table â”€â”€ */
.log-table { width:100%; border-collapse:collapse; font-size:12px; }
.log-table th {
  text-align:right; padding:10px 14px;
  color:var(--muted); font-weight:500; font-size:11px; text-transform:uppercase; letter-spacing:.8px;
  border-bottom:1px solid var(--border);
}
.log-table td { padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.04); }
.log-table tr:hover td { background:rgba(255,255,255,.02); }
.log-type {
  display:inline-block; border-radius:6px; padding:2px 8px;
  font-size:10px; font-weight:600;
}
.log-type.control { background:rgba(56,189,248,.12); color:var(--accent); }
.log-type.sensor { background:rgba(52,211,153,.12); color:var(--green); }
.log-type.alert { background:rgba(248,113,113,.12); color:var(--red); }
.log-type.access { background:rgba(251,191,36,.12); color:var(--yellow); }

/* â”€â”€ Scheduler â”€â”€ */
.schedule-item {
  display:flex; align-items:center; gap:14px;
  padding:14px; border-radius:12px; margin-bottom:10px;
  background:var(--card2); border:1px solid var(--border);
}
.sched-time { font-size:18px; font-weight:700; color:var(--accent); min-width:60px; }
.sched-info { flex:1; }
.sched-name { font-size:13px; font-weight:600; margin-bottom:2px; }
.sched-days { font-size:11px; color:var(--muted); }
.sched-action { font-size:11px; color:var(--green); margin-top:2px; }

/* â”€â”€ Camera â”€â”€ */
.cam-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.cam-card {
  border-radius:14px; overflow:hidden;
  border:1px solid var(--border); background:var(--card2);
  cursor:pointer; transition:border-color .2s;
}
.cam-card:hover { border-color:rgba(56,189,248,.4); }
.cam-view {
  aspect-ratio:16/9;
  background:repeating-linear-gradient(45deg,#0a0e1a 0,#0a0e1a 5px,#0e1422 5px,#0e1422 10px);
  display:flex; align-items:center; justify-content:center;
  position:relative;
}
.cam-overlay {
  position:absolute; top:8px; right:8px;
  display:flex; align-items:center; gap:4px;
  background:rgba(248,113,113,.9); border-radius:5px;
  padding:2px 7px; font-size:9px; font-weight:700; letter-spacing:.5px;
}
.cam-dot { width:5px;height:5px;background:white;border-radius:50%;animation:pulse 1s infinite; }
.cam-label-bar {
  padding:10px 14px; display:flex; justify-content:space-between; align-items:center;
}
.cam-name { font-size:12px; font-weight:600; }
.cam-loc { font-size:11px; color:var(--muted); }

/* â”€â”€ Add schedule form â”€â”€ */
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px; }
.form-group { display:flex; flex-direction:column; gap:6px; }
.form-group label { font-size:11px; color:var(--muted); }
.form-group select, .form-group input {
  background:var(--card2); border:1px solid var(--border);
  border-radius:10px; padding:10px 14px; color:var(--text); font-family:inherit; font-size:13px; outline:none;
  transition:border-color .2s;
}
.form-group select:focus, .form-group input:focus { border-color:var(--accent); }
.btn-add {
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none; border-radius:10px; padding:10px 20px;
  color:white; font-family:inherit; font-size:13px; font-weight:600; cursor:pointer;
  transition:opacity .2s;
}
.btn-add:hover { opacity:.85; }

/* â”€â”€ Section header â”€â”€ */
.sec-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
.sec-title { font-size:14px; font-weight:600; }
.sec-action {
  background:none; border:1px solid var(--border); border-radius:8px;
  padding:5px 12px; color:var(--muted); font-size:11px; cursor:pointer; font-family:inherit;
  transition:all .2s;
}
.sec-action:hover { border-color:var(--accent); color:var(--accent); }

.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.mt16 { margin-top:16px; }
</style>
</head>
<body>

<!-- â•â• LOGIN â•â• -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">ğŸ </div>
    <h2>Smart Home System</h2>
    <p>King Abdulaziz University â€” Team 34</p>
    <div class="input-group">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <input type="text" id="loginUser" value="admin" placeholder="admin">
    </div>
    <div class="input-group">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="loginPass" value="1234" placeholder="â€¢â€¢â€¢â€¢">
    </div>
    <button class="btn-login" onclick="doLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â†’</button>
    <div class="login-hint">ØªØ¬Ø±ÙŠØ¨ÙŠ: admin / 1234</div>
  </div>
</div>

<!-- â•â• APP â•â• -->
<div id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-row">
      <div class="logo-icon">ğŸ </div>
      <div class="logo-text">
        <h3>Smart Home</h3>
        <span>Team 34 â€” EE499</span>
      </div>
    </div>
    <div class="online-pill">
      <div class="pulse"></div>
      Ù…ØªØµÙ„ Ø¨Ù€ AWS Cloud
    </div>
  </div>

  <nav>
    <div class="nav-section">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item active" onclick="goPage('overview',this)">
      <span class="icon">ğŸ“Š</span> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
    </div>

    <div class="nav-section">Ø§Ù„ØªØ­ÙƒÙ…</div>
    <div class="nav-item" onclick="goPage('control',this)">
      <span class="icon">ğŸ›ï¸</span> Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
    </div>
    <div class="nav-item" onclick="goPage('scheduler',this)">
      <span class="icon">â°</span> Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
    </div>

    <div class="nav-section">Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</div>
    <div class="nav-item" onclick="goPage('monitoring',this)">
      <span class="icon">ğŸ“¡</span> Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª
    </div>
    <div class="nav-item" onclick="goPage('cameras',this)">
      <span class="icon">ğŸ“¹</span> Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª (ESP32-CAM)
    </div>

    <div class="nav-section">Ø§Ù„Ø£Ù…Ø§Ù†</div>
    <div class="nav-item" onclick="goPage('alerts',this)">
      <span class="icon">ğŸš¨</span> Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
      <span class="badge" id="alertBadge">3</span>
    </div>
    <div class="nav-item" onclick="goPage('logs',this)">
      <span class="icon">ğŸ“‹</span> Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    </div>
  </nav>

  <div class="sidebar-bottom">
    <div class="user-row" onclick="doLogout()">
      <div class="avatar">Ù…</div>
      <div class="user-info">
        <div class="user-name">Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù†</div>
        <div class="user-role">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ â†©</div>
      </div>
    </div>
  </div>
</div>

<div id="main">
  <div class="topbar">
    <div>
      <div class="page-title" id="pageTitle">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
      <div class="page-sub">Cloud-Centric Architecture â€¢ MQTT over TLS â€¢ ESP32</div>
    </div>
    <div class="topbar-right">
      <div class="chip">ğŸŒ¡ï¸ <span id="tempChip">22Â°Ù… Ø¯Ø§Ø®Ù„ÙŠ</span></div>
      <div class="chip">âš¡ <span>4.2 kWh</span></div>
      <div class="alert-bell" onclick="goPage('alerts',null)">
        ğŸ”” <div class="notif"></div>
      </div>
    </div>
  </div>

  <div id="content">

    <!-- â•â• OVERVIEW PAGE â•â• -->
    <div class="page active" id="page-overview">
      <div class="stats-row">
        <div class="stat" style="--c:var(--green)">
          <div class="stat-icon">ğŸ“±</div>
          <div class="stat-label">Ø£Ø¬Ù‡Ø²Ø© Ù†Ø´Ø·Ø©</div>
          <div class="stat-val" id="activeDevCount">5</div>
          <div class="stat-unit">Ù…Ù† Ø£ØµÙ„ 8 Ø£Ø¬Ù‡Ø²Ø©</div>
        </div>
        <div class="stat" style="--c:var(--accent)">
          <div class="stat-icon">ğŸŒ¡ï¸</div>
          <div class="stat-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
          <div class="stat-val">22Â°</div>
          <div class="stat-unit">Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø²Ù„</div>
        </div>
        <div class="stat" style="--c:var(--yellow)">
          <div class="stat-icon">ğŸ”¥</div>
          <div class="stat-label">Ø­Ø³Ø§Ø³ Ø§Ù„Ø¯Ø®Ø§Ù†</div>
          <div class="stat-val" style="font-size:18px;padding-top:4px;">Ø¢Ù…Ù†</div>
          <div class="stat-unit">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
        </div>
        <div class="stat" style="--c:var(--red)">
          <div class="stat-icon">ğŸš¨</div>
          <div class="stat-label">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
          <div class="stat-val">3</div>
          <div class="stat-unit">ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
        </div>
      </div>

      <div class="grid-2">
        <div>
          <div class="sec-header">
            <div class="sec-title">âš¡ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</div>
            <button class="sec-action" onclick="goPage('control',null)">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
          </div>
          <div style="display:flex;flex-direction:column;gap:10px;" id="quickDevices"></div>
        </div>
        <div>
          <div class="sec-header">
            <div class="sec-title">ğŸ“¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª</div>
            <button class="sec-action" onclick="goPage('monitoring',null)">ØªÙØ§ØµÙŠÙ„</button>
          </div>
          <div class="sensors-grid" id="overviewSensors"></div>
        </div>
      </div>

      <div class="mt16">
        <div class="sec-header">
          <div class="sec-title">ğŸš¨ Ø¢Ø®Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
          <button class="sec-action" onclick="goPage('alerts',null)">ÙƒÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</button>
        </div>
        <div id="overviewAlerts"></div>
      </div>
    </div>

    <!-- â•â• CONTROL PAGE â•â• -->
    <div class="page" id="page-control">
      <div class="sec-header">
        <div class="sec-title">ğŸ›ï¸ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© â€” ESP32 Ø¹Ø¨Ø± MQTT</div>
        <button class="sec-action" onclick="allOff()">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„</button>
      </div>
      <div class="devices-grid" id="devicesGrid"></div>
    </div>

    <!-- â•â• SCHEDULER PAGE â•â• -->
    <div class="page" id="page-scheduler">
      <div class="grid-2" style="align-items:start">
        <div>
          <div class="sec-header">
            <div class="sec-title">â° Ø¬Ø¯Ø§ÙˆÙ„ Ù…ÙØ¹Ù‘Ù„Ø©</div>
          </div>
          <div id="scheduleList"></div>
        </div>
        <div class="panel">
          <div class="panel-title">â• Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯</div>
          <div class="form-row">
            <div class="form-group">
              <label>Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
              <select id="sDevice">
                <option>Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option>
                <option>Ø§Ù„Ù…Ø±ÙˆØ­Ø©</option>
                <option>Ù‚ÙÙ„ Ø§Ù„Ø¨Ø§Ø¨</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</label>
              <select id="sAction">
                <option>ØªØ´ØºÙŠÙ„</option>
                <option>Ø¥ÙŠÙ‚Ø§Ù</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Ø§Ù„ÙˆÙ‚Øª</label>
              <input type="time" id="sTime" value="07:00">
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø£ÙŠØ§Ù…</label>
              <select id="sDays">
                <option>ÙƒÙ„ ÙŠÙˆÙ…</option>
                <option>Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                <option>Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
              </select>
            </div>
          </div>
          <button class="btn-add" onclick="addSchedule()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
        </div>
      </div>
    </div>

    <!-- â•â• MONITORING PAGE â•â• -->
    <div class="page" id="page-monitoring">
      <div class="sec-header">
        <div class="sec-title">ğŸ“¡ Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª â€” ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ</div>
        <div class="chip" style="font-size:11px">ØªØ£Ø®ÙŠØ±: â‰¤5 Ø« â€¢ MQTT</div>
      </div>
      <div class="sensors-grid" style="grid-template-columns:repeat(3,1fr)" id="allSensors"></div>
    </div>

    <!-- â•â• CAMERAS PAGE â•â• -->
    <div class="page" id="page-cameras">
      <div class="sec-header">
        <div class="sec-title">ğŸ“¹ ÙƒØ§Ù…ÙŠØ±Ø§Øª ESP32-CAM â€” Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</div>
        <div class="chip" style="font-size:11px">ISO/IEC 14496 â€¢ IEEE 802.11</div>
      </div>
      <div style="max-width:600px">
        <div class="cam-card">
          <div class="cam-view" style="aspect-ratio:16/9;position:relative">
            <div style="font-size:54px;opacity:.1;position:absolute">ğŸ“·</div>
            <div class="cam-overlay"><div class="cam-dot"></div>Ù…Ø¨Ø§Ø´Ø±</div>
            <!-- Fake scan line effect -->
            <div style="position:absolute;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(56,189,248,.015) 3px,rgba(56,189,248,.015) 4px);pointer-events:none"></div>
            <!-- Corner brackets -->
            <div style="position:absolute;top:12px;right:12px;width:20px;height:20px;border-top:2px solid var(--accent);border-right:2px solid var(--accent);border-radius:0 4px 0 0"></div>
            <div style="position:absolute;top:12px;left:12px;width:20px;height:20px;border-top:2px solid var(--accent);border-left:2px solid var(--accent);border-radius:4px 0 0 0"></div>
            <div style="position:absolute;bottom:12px;right:12px;width:20px;height:20px;border-bottom:2px solid var(--accent);border-right:2px solid var(--accent);border-radius:0 0 4px 0"></div>
            <div style="position:absolute;bottom:12px;left:12px;width:20px;height:20px;border-bottom:2px solid var(--accent);border-left:2px solid var(--accent);border-radius:0 0 0 4px"></div>
          </div>
          <div class="cam-label-bar" style="padding:16px 18px">
            <div>
              <div class="cam-name" style="font-size:15px">ğŸšª Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
              <div class="cam-loc" style="margin-top:3px">ESP32-CAM â€¢ IEEE 802.11 â€¢ ISO/IEC 14496</div>
            </div>
            <div style="display:flex;gap:8px">
              <button class="sec-action" style="font-size:11px" onclick="takeSS()">ğŸ“¸ Ù„Ù‚Ø·Ø©</button>
              <button class="btn-add" style="font-size:12px;padding:7px 16px" onclick="openDoor()">ğŸ”“ ÙØªØ­ Ø§Ù„Ø¨Ø§Ø¨</button>
            </div>
          </div>
        </div>

        <!-- Door status -->
        <div class="panel" style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-size:13px;font-weight:600;margin-bottom:4px">Ø­Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ø°ÙƒÙŠ</div>
              <div id="doorStatusTxt" style="font-size:12px;color:var(--green)">ğŸ” Ù…ØºÙ„Ù‚ â€” Ø¢Ù…Ù†</div>
            </div>
            <span class="status-badge ok" id="doorBadge">Ù…ØºÙ„Ù‚</span>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• ALERTS PAGE â•â• -->
    <div class="page" id="page-alerts">
      <div class="sec-header">
        <div class="sec-title">ğŸš¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª â€” Ø§Ø³ØªØ¬Ø§Ø¨Ø© â‰¤5 Ø«ÙˆØ§Ù†Ù</div>
        <button class="sec-action" onclick="markAllRead()">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
      </div>
      <div id="alertsList"></div>
    </div>

    <!-- â•â• LOGS PAGE â•â• -->
    <div class="page" id="page-logs">
      <div class="sec-header">
        <div class="sec-title">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« â€” Cloud Database</div>
        <div class="chip" style="font-size:11px">ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: â‰¤1 Ø«Ø§Ù†ÙŠØ©</div>
      </div>
      <div class="panel">
        <table class="log-table">
          <thead>
            <tr>
              <th>Ø§Ù„ÙˆÙ‚Øª</th>
              <th>Ø§Ù„Ù†ÙˆØ¹</th>
              <th>Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
              <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            </tr>
          </thead>
          <tbody id="logsBody"></tbody>
        </table>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const devices = [
  { id:0, name:'Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', emoji:'ğŸ’¡', on:true,  hasSlider:true,  sliderLabel:'Ø§Ù„Ø³Ø·ÙˆØ¹', sliderVal:75, status:'75%', pin:'GPIO2' },
  { id:1, name:'Ø§Ù„Ù…Ø±ÙˆØ­Ø©',          emoji:'ğŸŒ€', on:true,  hasSlider:true,  sliderLabel:'Ø§Ù„Ø³Ø±Ø¹Ø©',  sliderVal:60, status:'60%', pin:'GPIO4' },
  { id:2, name:'Ù‚ÙÙ„ Ø§Ù„Ø¨Ø§Ø¨',        emoji:'ğŸ”', on:true,  hasSlider:false, sliderLabel:'',        sliderVal:0,  status:'Ù…ØºÙ„Ù‚ â€¢ Ø¢Ù…Ù†', pin:'GPIO5' },
  { id:3, name:'Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù…Ø·Ø¨Ø®',    emoji:'ğŸ’¡', on:false, hasSlider:true,  sliderLabel:'Ø§Ù„Ø³Ø·ÙˆØ¹', sliderVal:100,status:'Ù…Ø·ÙØ£', pin:'GPIO12' },
  { id:4, name:'Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©',   emoji:'ğŸŒŸ', on:false, hasSlider:true,  sliderLabel:'Ø§Ù„Ø³Ø·ÙˆØ¹', sliderVal:50, status:'Ù…Ø·ÙØ£', pin:'GPIO13' },
  { id:5, name:'Ù…Ø¶Ø®Ø© Ø§Ù„Ø±ÙŠ',       emoji:'ğŸ’§', on:false, hasSlider:false, sliderLabel:'',        sliderVal:0,  status:'Ù…Ø·ÙØ£', pin:'GPIO14' },
  { id:6, name:'Ù…ÙƒÙŠÙ Ø§Ù„Ù‡ÙˆØ§Ø¡',     emoji:'â„ï¸', on:true,  hasSlider:true,  sliderLabel:'Ø§Ù„Ø­Ø±Ø§Ø±Ø©',sliderVal:22, status:'22Â°Ù…', pin:'GPIO15' },
  { id:7, name:'Ù…ÙƒØ¨Ø± Ø§Ù„ØµÙˆØª',      emoji:'ğŸ”Š', on:true,  hasSlider:true,  sliderLabel:'Ø§Ù„ØµÙˆØª',  sliderVal:40, status:'40%', pin:'GPIO16' },
];

const sensors = [
  { name:'Ø­Ø³Ø§Ø³ Ø§Ù„Ø¯Ø®Ø§Ù†',   emoji:'ğŸ”¥', val:'0 ppm',  unit:'Ø¢Ù…Ù†',    type:'smoke',    status:'ok' },
  { name:'Ø­Ø³Ø§Ø³ Ø§Ù„Ø­Ø±ÙƒØ©',   emoji:'ğŸƒ', val:'Ù„Ø§ ÙŠÙˆØ¬Ø¯', unit:'Ø­Ø±ÙƒØ©',  type:'motion',   status:'ok' },
  { name:'Ø¨Ø§Ø¨ Ø±Ø¦ÙŠØ³ÙŠ',     emoji:'ğŸšª', val:'Ù…ØºÙ„Ù‚',   unit:'Ù…Ø²Ù„Ø§Ø¬', type:'door',     status:'ok' },
  { name:'Ø§Ù„Ø­Ø±Ø§Ø±Ø©',        emoji:'ğŸŒ¡ï¸', val:'22Â°',    unit:'Ù…Ø¦ÙˆÙŠØ©', type:'temp',     status:'ok' },
  { name:'Ø§Ù„Ø±Ø·ÙˆØ¨Ø©',        emoji:'ğŸ’§', val:'58%',    unit:'Ù†Ø³Ø¨Ø©',  type:'humidity', status:'ok' },
  { name:'Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡',   emoji:'ğŸŒ¬ï¸', val:'Ø¬ÙŠØ¯',    unit:'AQI',   type:'air',      status:'ok' },
];

const alerts = [
  { id:0, title:'ğŸš¨ Ø­Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹ØªØ§Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', time:'Ù…Ù†Ø° 5 Ø¯Ù‚Ø§Ø¦Ù‚', type:'danger', read:false },
  { id:1, title:'ğŸ”¥ Ø§Ø±ØªÙØ§Ø¹ Ø·ÙÙŠÙ ÙÙŠ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø¨Ø®', time:'Ù…Ù†Ø° 18 Ø¯Ù‚ÙŠÙ‚Ø©', type:'warn', read:false },
  { id:2, title:'ğŸ” ØªÙ…Øª Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ Ø§Ù„Ø¨Ø§Ø¨ 3 Ù…Ø±Ø§Øª', time:'Ù…Ù†Ø° 25 Ø¯Ù‚ÙŠÙ‚Ø©', type:'danger', read:false },
  { id:3, title:'âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø¬Ø¯ÙˆÙ„)', time:'Ù…Ù†Ø° 2 Ø³Ø§Ø¹Ø©', type:'ok', read:true },
  { id:4, title:'ğŸ“¡ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø¨Ø³ÙŠØ· ÙÙŠ Wi-Fi ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„', time:'Ù…Ù†Ø° 3 Ø³Ø§Ø¹Ø§Øª', type:'warn', read:true },
];

const schedules = [
  { time:'07:00', device:'Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', action:'ØªØ´ØºÙŠÙ„', days:'ÙƒÙ„ ÙŠÙˆÙ…', on:true },
  { time:'23:00', device:'Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', action:'Ø¥ÙŠÙ‚Ø§Ù', days:'ÙƒÙ„ ÙŠÙˆÙ…', on:true },
  { time:'06:30', device:'Ù…Ø¶Ø®Ø© Ø§Ù„Ø±ÙŠ', action:'ØªØ´ØºÙŠÙ„', days:'Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', on:true },
  { time:'22:30', device:'Ù‚ÙÙ„ Ø§Ù„Ø¨Ø§Ø¨', action:'Ù‚ÙÙ„', days:'ÙƒÙ„ ÙŠÙˆÙ…', on:false },
];

const logs = [
  { time:'10:42:15', type:'control', device:'Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', action:'ØªØ´ØºÙŠÙ„ (Ø³Ø·ÙˆØ¹ 75%)', user:'admin' },
  { time:'10:38:02', type:'sensor',  device:'Ø­Ø³Ø§Ø³ Ø§Ù„Ø­Ø±ÙƒØ©', action:'Ø­Ø±ÙƒØ© Ù…ÙƒØªØ´ÙØ©', user:'Ø§Ù„Ù†Ø¸Ø§Ù…' },
  { time:'10:35:44', type:'alert',   device:'Ø¨Ø§Ø¨ Ø±Ø¦ÙŠØ³ÙŠ', action:'Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ ØºÙŠØ± Ù…ØµØ±Ø­Ø©', user:'Ø§Ù„Ù†Ø¸Ø§Ù…' },
  { time:'10:20:10', type:'access',  device:'Ù‚ÙÙ„ Ø§Ù„Ø¨Ø§Ø¨', action:'ØªÙ… Ø§Ù„ÙØªØ­', user:'admin' },
  { time:'09:55:00', type:'control', device:'Ø§Ù„Ù…Ø±ÙˆØ­Ø©', action:'ØªØ´ØºÙŠÙ„ (Ø³Ø±Ø¹Ø© 60%)', user:'admin' },
  { time:'09:30:00', type:'sensor',  device:'Ø­Ø³Ø§Ø³ Ø§Ù„Ø¯Ø®Ø§Ù†', action:'Ù‚Ø±Ø§Ø¡Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© 0 ppm', user:'Ø§Ù„Ù†Ø¸Ø§Ù…' },
  { time:'08:00:00', type:'control', device:'Ù…ÙƒÙŠÙ Ø§Ù„Ù‡ÙˆØ§Ø¡', action:'ØªØ´ØºÙŠÙ„ 22Â°Ù…', user:'Ø¬Ø¯ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ' },
  { time:'07:00:00', type:'control', device:'Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', action:'ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ', user:'Ø¬Ø¯ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ' },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOGIN
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin() {
  const u = document.getElementById('loginUser').value;
  const p = document.getElementById('loginPass').value;
  if (u === 'admin' && p === '1234') {
    document.getElementById('loginScreen').style.animation = 'fadeIn .3s ease reverse';
    setTimeout(() => document.getElementById('loginScreen').style.display = 'none', 280);
    render();
  } else {
    document.getElementById('loginPass').style.borderColor = 'var(--red)';
    setTimeout(() => document.getElementById('loginPass').style.borderColor = '', 1500);
  }
}

function doLogout() {
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('loginScreen').style.animation = 'fadeIn .3s ease';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAVIGATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const titles = {
  overview:'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', control:'Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©',
  scheduler:'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', monitoring:'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª',
  cameras:'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª (ESP32-CAM)', alerts:'Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', logs:'Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«'
};

function goPage(id, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (el) el.classList.add('active');
  else {
    document.querySelectorAll('.nav-item').forEach(n => {
      if (n.getAttribute('onclick') && n.getAttribute('onclick').includes("'"+id+"'")) n.classList.add('active');
    });
  }
  document.getElementById('pageTitle').textContent = titles[id] || id;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  renderDevicesGrid();
  renderQuickDevices();
  renderOverviewSensors();
  renderAllSensors();
  renderAlerts();
  renderOverviewAlerts();
  renderLogs();
  renderSchedules();
  updateActiveCount();
}

function updateActiveCount() {
  const c = devices.filter(d => d.on).length;
  document.getElementById('activeDevCount').textContent = c;
}

// Devices full grid
function renderDevicesGrid() {
  const g = document.getElementById('devicesGrid');
  g.innerHTML = devices.map(d => `
    <div class="dev-card ${d.on?'on':''}" id="dcard-${d.id}" onclick="toggleDev(${d.id})">
      <div class="dev-top">
        <div class="dev-emoji">${d.emoji}</div>
        <div class="tog ${d.on?'on':''}" id="dtog-${d.id}" onclick="event.stopPropagation();toggleDev(${d.id})">
          <div class="tog-thumb"></div>
        </div>
      </div>
      <div class="dev-name">${d.name}</div>
      <div class="dev-status ${d.on?'on':''}" id="dstatus-${d.id}">${d.on?'ØªØ´ØºÙŠÙ„ â€¢ '+d.status:'Ø¥ÙŠÙ‚Ø§Ù'}</div>
      <div style="font-size:10px;color:var(--muted);margin-top:3px">ğŸ“ ${d.pin}</div>
      ${d.hasSlider && d.on ? `
      <div class="dev-slider" onclick="event.stopPropagation()">
        <div class="slider-row"><span>${d.sliderLabel}</span><span id="dsval-${d.id}">${d.sliderVal}${d.sliderLabel==='Ø§Ù„Ø­Ø±Ø§Ø±Ø©'?'Â°':'%'}</span></div>
        <input type="range" min="${d.sliderLabel==='Ø§Ù„Ø­Ø±Ø§Ø±Ø©'?16:0}" max="${d.sliderLabel==='Ø§Ù„Ø­Ø±Ø§Ø±Ø©'?30:100}" value="${d.sliderVal}"
          oninput="updateSlider(${d.id},this.value)">
      </div>` : ''}
    </div>`).join('');
}

// Quick devices for overview
function renderQuickDevices() {
  const el = document.getElementById('quickDevices');
  if (!el) return;
  el.innerHTML = devices.slice(0,5).map(d => `
    <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--card2);border-radius:12px;border:1px solid var(--border)">
      <span style="font-size:18px">${d.emoji}</span>
      <div style="flex:1">
        <div style="font-size:13px;font-weight:600">${d.name}</div>
        <div style="font-size:11px;color:${d.on?'var(--green)':'var(--muted)'}">${d.on?'ØªØ´ØºÙŠÙ„':'Ø¥ÙŠÙ‚Ø§Ù'}</div>
      </div>
      <div class="tog ${d.on?'on':''}" onclick="toggleDev(${d.id});renderQuickDevices()">
        <div class="tog-thumb"></div>
      </div>
    </div>`).join('');
}

function renderOverviewSensors() {
  const el = document.getElementById('overviewSensors');
  if (!el) return;
  el.innerHTML = sensors.slice(0,4).map(s => `
    <div class="sensor-card">
      <div class="sensor-top">
        <span>${s.emoji}</span>
        <span class="status-badge ${s.status}">Ø¢Ù…Ù†</span>
      </div>
      <div class="sensor-lbl">${s.name}</div>
      <div class="sensor-val">${s.val}</div>
      <div class="sensor-unit">${s.unit}</div>
    </div>`).join('');
}

function renderAllSensors() {
  const el = document.getElementById('allSensors');
  if (!el) return;
  el.innerHTML = sensors.map(s => `
    <div class="sensor-card">
      <div class="sensor-top">
        <span style="font-size:26px">${s.emoji}</span>
        <span class="status-badge ${s.status}">Ø¢Ù…Ù†</span>
      </div>
      <div class="sensor-lbl" style="margin-bottom:8px">${s.name}</div>
      <div class="sensor-val">${s.val}</div>
      <div class="sensor-unit">${s.unit}</div>
    </div>`).join('');
}

function renderAlerts() {
  const el = document.getElementById('alertsList');
  if (!el) return;
  el.innerHTML = alerts.map(a => `
    <div class="alert-item ${a.type} ${a.read?'':'unread'}" id="alert-${a.id}">
      <div class="alert-icon">${a.type==='danger'?'ğŸ”´':a.type==='warn'?'ğŸŸ¡':'ğŸŸ¢'}</div>
      <div class="alert-body">
        <div class="alert-title">${a.title}</div>
        <div class="alert-time">ğŸ• ${a.time}</div>
      </div>
      ${!a.read?`<button class="mark-btn" onclick="markRead(${a.id})">Ù…Ù‚Ø±ÙˆØ¡</button>`:''}
    </div>`).join('');
  const unread = alerts.filter(a=>!a.read).length;
  document.getElementById('alertBadge').textContent = unread || '';
  document.getElementById('alertBadge').style.display = unread ? 'block' : 'none';
}

function renderOverviewAlerts() {
  const el = document.getElementById('overviewAlerts');
  if (!el) return;
  el.innerHTML = alerts.slice(0,3).map(a => `
    <div class="alert-item ${a.type} ${a.read?'':'unread'}" style="margin-bottom:8px">
      <div class="alert-icon">${a.type==='danger'?'ğŸ”´':a.type==='warn'?'ğŸŸ¡':'ğŸŸ¢'}</div>
      <div class="alert-body">
        <div class="alert-title">${a.title}</div>
        <div class="alert-time">${a.time}</div>
      </div>
    </div>`).join('');
}

function renderLogs() {
  const el = document.getElementById('logsBody');
  if (!el) return;
  el.innerHTML = logs.map(l => `
    <tr>
      <td style="color:var(--muted)">${l.time}</td>
      <td><span class="log-type ${l.type}">${{control:'ØªØ­ÙƒÙ…',sensor:'Ø­Ø³Ø§Ø³',alert:'ØªÙ†Ø¨ÙŠÙ‡',access:'ÙˆØµÙˆÙ„'}[l.type]}</span></td>
      <td>${l.device}</td>
      <td>${l.action}</td>
      <td style="color:var(--muted)">${l.user}</td>
    </tr>`).join('');
}

function renderSchedules() {
  const el = document.getElementById('scheduleList');
  if (!el) return;
  el.innerHTML = schedules.map((s,i) => `
    <div class="schedule-item">
      <div class="sched-time">${s.time}</div>
      <div class="sched-info">
        <div class="sched-name">${s.device}</div>
        <div class="sched-days">ğŸ“… ${s.days}</div>
        <div class="sched-action">â†’ ${s.action}</div>
      </div>
      <div class="tog ${s.on?'on':''}" onclick="toggleSched(${i})">
        <div class="tog-thumb"></div>
      </div>
    </div>`).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ACTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleDev(id) {
  devices[id].on = !devices[id].on;
  renderDevicesGrid();
  renderQuickDevices();
  updateActiveCount();
  // Log it
  logs.unshift({
    time: new Date().toLocaleTimeString('ar-SA'),
    type:'control', device:devices[id].name,
    action: devices[id].on ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù', user:'admin'
  });
  renderLogs();
}

function updateSlider(id, val) {
  devices[id].sliderVal = parseInt(val);
  const suf = devices[id].sliderLabel === 'Ø§Ù„Ø­Ø±Ø§Ø±Ø©' ? 'Â°' : '%';
  const el = document.getElementById('dsval-'+id);
  if (el) el.textContent = val + suf;
}

function allOff() {
  devices.forEach(d => d.on = false);
  renderDevicesGrid();
  renderQuickDevices();
  updateActiveCount();
}

function markRead(id) {
  alerts[id].read = true;
  renderAlerts();
  renderOverviewAlerts();
}

function markAllRead() {
  alerts.forEach(a => a.read = true);
  renderAlerts();
  renderOverviewAlerts();
}

function toggleSched(i) {
  schedules[i].on = !schedules[i].on;
  renderSchedules();
}

function addSchedule() {
  const device = document.getElementById('sDevice').value;
  const action = document.getElementById('sAction').value;
  const time = document.getElementById('sTime').value;
  const days = document.getElementById('sDays').value;
  schedules.unshift({ time, device, action, days, on:true });
  renderSchedules();
}

function openDoor() {
  const btn = event.target;
  const isOpen = btn.textContent.includes('Ø¥ØºÙ„Ø§Ù‚');
  if (isOpen) {
    btn.textContent = 'ğŸ”“ ÙØªØ­ Ø§Ù„Ø¨Ø§Ø¨';
    btn.style.background = 'linear-gradient(135deg,var(--accent),var(--accent2))';
    document.getElementById('doorStatusTxt').textContent = 'ğŸ” Ù…ØºÙ„Ù‚ â€” Ø¢Ù…Ù†';
    document.getElementById('doorStatusTxt').style.color = 'var(--green)';
    document.getElementById('doorBadge').textContent = 'Ù…ØºÙ„Ù‚';
    document.getElementById('doorBadge').className = 'status-badge ok';
  } else {
    btn.textContent = 'ğŸ”’ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø§Ø¨';
    btn.style.background = 'linear-gradient(135deg,var(--orange),var(--red))';
    document.getElementById('doorStatusTxt').textContent = 'ğŸ”“ Ù…ÙØªÙˆØ­';
    document.getElementById('doorStatusTxt').style.color = 'var(--orange)';
    document.getElementById('doorBadge').textContent = 'Ù…ÙØªÙˆØ­';
    document.getElementById('doorBadge').className = 'status-badge warn';
  }
  logs.unshift({ time: new Date().toLocaleTimeString('ar-SA'), type:'access', device:'Ù‚ÙÙ„ Ø§Ù„Ø¨Ø§Ø¨', action: isOpen ? 'Ø¥ØºÙ„Ø§Ù‚' : 'ÙØªØ­', user:'admin' });
  renderLogs();
}

function takeSS() {
  const btn = event.target;
  btn.textContent = 'â³ ...';
  setTimeout(() => { btn.textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸'; setTimeout(() => btn.textContent = 'ğŸ“¸ Ù„Ù‚Ø·Ø©', 1500); }, 800);
  logs.unshift({ time: new Date().toLocaleTimeString('ar-SA'), type:'access', device:'ESP32-CAM', action:'Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø©', user:'admin' });
  renderLogs();
}

// Simulate real-time MQTT updates
setInterval(() => {
  // Random sensor fluctuation
  sensors[3].val = (21 + Math.random()*2).toFixed(1) + 'Â°';
  sensors[4].val = (55 + Math.random()*8).toFixed(0) + '%';
  document.getElementById('tempChip').textContent = sensors[3].val + ' Ø¯Ø§Ø®Ù„ÙŠ';
  if (document.getElementById('page-monitoring').classList.contains('active')) renderAllSensors();
  if (document.getElementById('page-overview').classList.contains('active')) renderOverviewSensors();
}, 3000);
</script>
</body>
</html>
